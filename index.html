<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Disorderly Clone ‚Äì Quiz del Giorno</title>
  <meta name="description" content="Clone statico stile playdisorderly.com: riordina gli elementi e indovina il posizionamento. Personalizzabile via JSON." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0d12;
      --panel:#121826;
      --panel-2:#0f1522;
      --text:#e6edf6;
      --muted:#94a3b8;
      --brand:#6ee7ff;
      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
      --card:#131a29;
      --border:#213045;
      --shadow: 0 4px 20px rgba(0,0,0,.4);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 800px at 80% -10%, #1a2031 0%, var(--bg) 60%);color:var(--text);font:16px/1.5 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--brand);text-decoration:none}
    .container{max-width:980px;margin:0 auto;padding:24px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:20px}
    .logo{display:flex;align-items:center;gap:10px}
    .logo .mark{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,#78ffd6,#007991);box-shadow:var(--shadow)}
    .title{font-weight:800;font-size:22px;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:13px}
    .panel{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:860px){.row{grid-template-columns:1fr}}

    /* Controls */
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    button{background:#0f1729;border:1px solid var(--border);color:var(--text);padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;transition:.2s transform,.2s background}
    button:hover{transform:translateY(-1px)}
    .primary{background:linear-gradient(180deg,#10324a,#092235);border-color:#0c324e}
    .success{background:linear-gradient(180deg,#0f2f1d,#0b2417);border-color:#143c26}
    .danger{background:linear-gradient(180deg,#3b0f16,#270b10);border-color:#58111a}
    .muted{opacity:.85}

    /* Quiz area */
    .quiz-head{display:flex;justify-content:space-between;gap:10px;align-items:flex-start;margin-bottom:12px}
    .topic{font-size:18px;font-weight:700}
    .meta{color:var(--muted);font-size:13px}

    .cards{display:grid;gap:10px}
    .card{display:flex;align-items:center;gap:12px;padding:12px;border:1px solid var(--border);background:var(--card);border-radius:14px;user-select:none}
    .handle{width:22px;height:22px;border-radius:8px;background:linear-gradient(180deg,#1e2638,#141b2a);display:grid;place-items:center;border:1px solid #20324a}
    .handle::after{content:"‚ãÆ";letter-spacing:1px}
    .label{font-weight:600}
    .ghost{opacity:.4;transform:scale(.98)}

    /* feedback */
    .badge{margin-left:auto;font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
    .ok{background:rgba(22, 163, 74, .15);border-color:#1f8f51;color:#8de8a8}
    .off{background:rgba(245, 158, 11, .12);border-color:#a36c12;color:#ffd38a}
    .wrong{background:rgba(239, 68, 68, .12);border-color:#a33f3f;color:#ff9a9a}

    .score{font-weight:800;font-size:24px}
    .footer{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:14px}

    .notice{font-size:12px;color:var(--muted)}
    .hidden{display:none !important}
    .sr{position:absolute;left:-9999px}

    /* Editor */
    details.editor{margin-top:18px}
    textarea.conf{width:100%;min-height:180px;background:#0a0f19;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:12px;font-family:ui-monospace,SFMono-Regular,Menlo,monospace}
    .editor .actions{display:flex;gap:10px;margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo"><div class="mark" aria-hidden="true"></div><div><div class="title">Disorderly Clone</div><div class="sub">Riordina gli elementi ‚Üí indovina i posizionamenti</div></div></div>
      <div class="controls">
        <button id="btn-shuffle" class="muted" title="Rimescola">üîÄ Rimescola</button>
        <button id="btn-submit" class="primary" title="Conferma">‚úÖ Conferma</button>
        <button id="btn-reveal" class="danger" title="Rivela soluzioni">ü™Ñ Rivela</button>
        <button id="btn-share" class="muted" title="Condividi quiz">üîó Condividi</button>
      </div>
    </header>

    <section id="quiz" class="panel">
      <div class="quiz-head">
        <div>
          <div id="topic" class="topic">‚Äî</div>
          <div id="meta" class="meta">‚Äî</div>
        </div>
        <div class="score"><span id="score">0</span> / 100</div>
      </div>
      <div id="instructions" class="notice">Trascina le card per ordinarle dal pi√π <span id="dirWord">alto</span> al pi√π <span id="dirWord2">basso</span>, poi premi <b>Conferma</b>.</div>
      <div id="cards" class="cards" aria-live="polite"></div>
      <div class="footer">
        <div class="notice" id="footnote"></div>
        <div class="notice">Seed: <span id="seed">‚Äî</span></div>
      </div>

      <details class="editor">
        <summary>‚úèÔ∏è Modifica QUIZ del giorno (solo locale)</summary>
        <p class="notice">Suggerito per prove rapide. Per GitHub Pages, modifica il blocco JSON sotto al tag <code>QUIZ_DATA</code> e fai commit.</p>
        <textarea id="editor" class="conf"></textarea>
        <div class="actions">
          <button id="btn-apply" class="success">Applica configurazione</button>
          <button id="btn-reset" class="muted">Ripristina</button>
        </div>
      </details>
    </section>

    <section class="panel" style="margin-top:16px">
      <h3 style="margin:4px 0 8px 0">Come personalizzare</h3>
      <ol>
        <li>Modifica il JSON nel blocco <code>&lt;script id="QUIZ_DATA" type="application/json"&gt;</code> qui sotto.</li>
        <li>Ogni quiz ha: <code>id</code>, <code>title</code>, <code>direction</code> ("desc" o "asc"), <code>items</code> con <code>label</code> e <code>value</code>, opzionali <code>source</code>/<code>note</code>.</li>
        <li>Rotazione: <code>rotation</code> pu√≤ essere "byDate" (usa la data odierna) o "fixed" (usa <code>defaultId</code>).</li>
        <li>Override via URL: <code>?id=...</code> per forzare un quiz, oppure <code>?date=YYYY-MM-DD</code> per simulare un giorno.</li>
      </ol>
    </section>

    <!-- ================= CONFIGURAZIONE QUIZ ================= -->
    <script id="QUIZ_DATA" type="application/json">
    {
      "rotation": "byDate",
      "defaultId": "sample-football",
      "quizzes": [
        {
          "id": "sample-football",
          "title": "Serie A 23/24 ‚Äì Valore rosa (alto ‚Üí basso)",
          "direction": "desc",
          "source": "Dati dimostrativi ispirati a Transfermarkt",
          "note": "Esempio puramente illustrativo.",
          "items": [
            {"label": "Inter", "value": 900},
            {"label": "Juventus", "value": 800},
            {"label": "Napoli", "value": 700},
            {"label": "Milan", "value": 680},
            {"label": "Roma", "value": 620},
            {"label": "Atalanta", "value": 550}
          ]
        },
        {
          "id": "steam-players",
          "title": "Giochi Steam ‚Äì Utenti contemporanei (alto ‚Üí basso)",
          "direction": "desc",
          "source": "Dati inventati per demo",
          "items": [
            {"label": "Counter-Strike 2", "value": 1000},
            {"label": "Dota 2", "value": 800},
            {"label": "PUBG", "value": 700},
            {"label": "Apex Legends", "value": 450},
            {"label": "Baldur's Gate 3", "value": 300},
            {"label": "Elden Ring", "value": 250}
          ]
        },
        {
          "id": "cities-pop",
          "title": "Citt√† europee ‚Äì Popolazione (alto ‚Üí basso)",
          "direction": "desc",
          "source": "Demo",
          "items": [
            {"label": "Istanbul", "value": 15500},
            {"label": "Mosca", "value": 12600},
            {"label": "Londra", "value": 9300},
            {"label": "San Pietroburgo", "value": 5400},
            {"label": "Berlino", "value": 3800},
            {"label": "Madrid", "value": 3300}
          ]
        }
      ]
    }
    </script>

    <script>
      // ---------- Utility
      const $ = sel => document.querySelector(sel);
      const params = new URLSearchParams(location.search);
      const fmt = new Intl.NumberFormat('it-IT');
      const todayISO = () => (params.get('date') || new Date().toISOString().slice(0,10));
      const hash = str => {
        let h = 2166136261;
        for (let i=0;i<str.length;i++){ h ^= str.charCodeAt(i); h = Math.imul(h,16777619); }
        return (h>>>0);
      };

      // ---------- State
      let CONFIG = JSON.parse(document.getElementById('QUIZ_DATA').textContent);
      let QUIZ = null;
      let currentOrder = [];
      let correctOrder = [];
      let locked = false;

      // ---------- Load quiz
      function selectQuiz(){
        const list = CONFIG.quizzes;
        if(!Array.isArray(list)||!list.length) throw new Error('Nessun quiz definito');
        const idParam = params.get('id');
        if(idParam){ return list.find(q=>q.id===idParam) || list[0]; }
        if(CONFIG.rotation === 'fixed'){
          return list.find(q=>q.id===CONFIG.defaultId) || list[0];
        }
        // byDate rotation: pick by index using date hash
        const d = todayISO();
        const idx = hash(d) % list.length;
        return list[idx];
      }

      function mountQuiz(){
        QUIZ = selectQuiz();
        if(!QUIZ) return;
        $('#topic').textContent = QUIZ.title;
        $('#dirWord').textContent = QUIZ.direction === 'asc' ? 'basso' : 'alto';
        $('#dirWord2').textContent = QUIZ.direction === 'asc' ? 'alto' : 'basso';
        $('#meta').textContent = QUIZ.source ? `Fonte: ${QUIZ.source}` : '';
        $('#footnote').textContent = QUIZ.note || '';
        $('#seed').textContent = todayISO();

        const cards = $('#cards');
        cards.innerHTML = '';
        currentOrder = shuffle(QUIZ.items.map((it, i)=> ({...it, i})));
        correctOrder = [...QUIZ.items].sort((a,b)=> QUIZ.direction==='asc' ? a.value-b.value : b.value-a.value);
        currentOrder.forEach((it, pos)=> cards.appendChild(makeCard(it, pos)));
        locked = false;
        updateScore(0);
      }

      // ---------- DOM builders
      function makeCard(item, pos){
        const el = document.createElement('div');
        el.className = 'card';
        el.draggable = true;
        el.dataset.label = item.label;
        el.dataset.value = item.value;
        el.innerHTML = `
          <div class="handle" aria-hidden="true"></div>
          <div class="label">${item.label}</div>
          <div class="badge">${fmt.format(item.value)}</div>
        `;
        attachDnD(el);
        return el;
      }

      function updateScore(s){ $('#score').textContent = Math.round(s); }

      // ---------- Drag & Drop
      function attachDnD(card){
        card.addEventListener('dragstart', (e)=>{
          if(locked) return e.preventDefault();
          card.classList.add('ghost');
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/plain', card.dataset.label);
        });
        card.addEventListener('dragend', ()=> card.classList.remove('ghost'));

        card.addEventListener('dragover', (e)=>{
          e.preventDefault();
          const dragging = document.querySelector('.ghost');
          const cards = $('#cards');
          if(!dragging || dragging===card) return;
          const rect = card.getBoundingClientRect();
          const after = (e.clientY - rect.top) > rect.height/2;
          cards.insertBefore(dragging, after ? card.nextSibling : card);
        });
      }

      function readCurrentOrder(){
        return [...document.querySelectorAll('#cards .card')].map(c=>({label:c.dataset.label, value:Number(c.dataset.value)}));
      }

      // ---------- Logic
      function evaluate(){
        const now = readCurrentOrder();
        let correct = 0;
        let score = 0;
        const posMap = new Map(correctOrder.map((it,idx)=>[it.label, idx]));
        now.forEach((it, idx)=>{
          const should = posMap.get(it.label);
          const badge = [...document.querySelectorAll('#cards .card')][idx].querySelector('.badge');
          if(idx===should){
            correct++;
            badge.className = 'badge ok';
            badge.textContent = '‚úì';
          } else {
            const delta = Math.abs(idx-should);
            const n = correctOrder.length-1;
            const part = Math.max(0, 1 - delta/n); // 1 if close, 0 if far
            score += part * (100/correctOrder.length);
            badge.className = 'badge off';
            badge.textContent = idx<should ? '‚¨áÔ∏é' : '‚¨ÜÔ∏é';
          }
        });
        score += (correct * (100/correctOrder.length));
        updateScore(score);
        return {correct,score};
      }

      function reveal(){
        const cards = $('#cards');
        cards.innerHTML = '';
        correctOrder.forEach(it=>{
          const el = makeCard(it);
          const b = el.querySelector('.badge');
          b.className = 'badge ok';
          b.textContent = fmt.format(it.value);
          el.draggable = false;
          cards.appendChild(el);
        });
        locked = true;
      }

      function shuffle(arr){
        const a=[...arr];
        for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
        return a;
      }

      // ---------- Editor (client-side only)
      function openEditor(){
        const t = $('#editor');
        t.value = JSON.stringify(CONFIG, null, 2);
      }

      function applyEditor(){
        try{
          const next = JSON.parse($('#editor').value);
          CONFIG = next;
          document.getElementById('QUIZ_DATA').textContent = JSON.stringify(next);
          mountQuiz();
        }catch(err){
          alert('JSON non valido: '+err.message);
        }
      }

      // ---------- Events
      $('#btn-shuffle').addEventListener('click', ()=> mountQuiz());
      $('#btn-submit').addEventListener('click', ()=> evaluate());
      $('#btn-reveal').addEventListener('click', ()=> reveal());
      $('#btn-share').addEventListener('click', ()=>{
        const url = new URL(location.href);
        url.searchParams.set('id', QUIZ.id);
        navigator.clipboard.writeText(url.toString()).then(()=>{
          const btn=$('#btn-share');
          const txt=btn.textContent; btn.textContent='‚úÖ Copiato'; setTimeout(()=>btn.textContent=txt,1000);
        });
      });
      $('#btn-apply').addEventListener('click', applyEditor);
      $('#btn-reset').addEventListener('click', ()=>{ openEditor(); mountQuiz(); });

      document.addEventListener('keydown', (e)=>{
        if(e.key==='r' && (e.ctrlKey||e.metaKey)) { e.preventDefault(); mountQuiz(); }
      });

      // ---------- Init
      openEditor();
      mountQuiz();
    </script>
  </div>
</body>
</html>
